<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=360, height=640, initial-scale=1.0">
<title>Rajasthan GK Zone â€“ Daily Quiz</title>

<style>
body{
  margin:0;
  font-family: Arial;
  background:#111;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.box{
  width:360px;
  height:640px;
  background:#000;
  padding:15px;
  box-sizing:border-box;
}
h2{text-align:center;}
button{
  width:100%;
  padding:12px;
  margin:6px 0;
  font-size:16px;
  border:none;
  border-radius:8px;
}
.option{background:#222;color:#fff;}
.correct{background:green;}
.wrong{background:red;}
#progress{height:6px;background:#333;margin:10px 0;}
#bar{height:6px;background:#0f0;width:100%;}
</style>
</head>

<body>
<div class="box">

<div id="nameBox">
  <h2>Rajasthan GK Zone</h2>
  <input id="username" placeholder="Your Name" style="width:100%;padding:10px">
  <button onclick="startQuiz()">Start Quiz</button>
</div>

<div id="quizBox" style="display:none;">
  <div id="progress"><div id="bar"></div></div>
  <h3 id="q"></h3>
  <div id="options"></div>
</div>

<div id="resultBox" style="display:none;text-align:center;"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let questions=[];
let i=0, score=0, timer, timeLeft, userName="";

const today = new Date().toISOString().split("T")[0];

async function loadQuestions(){
  const snap = await getDocs(collection(db,"questions"));
  snap.forEach(d=>{
    if(d.data().date === today){
      questions.push(d.data());
    }
  });
}

await loadQuestions();

window.startQuiz = ()=>{
  userName = username.value.trim();
  if(!userName) return alert("Name required");
  if(localStorage.getItem("attempt")==today)
    return alert("Already attempted");

  nameBox.style.display="none";
  quizBox.style.display="block";
  showQ();
};

function showQ(){
  clearInterval(timer);
  let qn = questions[i];
  q.innerText = qn.question;
  options.innerHTML="";
  timeLeft = qn.time;

  qn.options.forEach((opt,idx)=>{
    let b=document.createElement("button");
    b.className="option";
    b.innerText=opt;
    b.onclick=()=>check(idx,b);
    options.appendChild(b);
  });

  timer=setInterval(()=>{
    timeLeft--;
    bar.style.width=(timeLeft/qn.time*100)+"%";
    if(timeLeft<=0){
      clearInterval(timer);
      autoCorrect();
    }
  },1000);
}

function check(idx,btn){
  clearInterval(timer);
  let qn=questions[i];
  if(idx===qn.correct){
    btn.classList.add("correct");
    score++;
  }else{
    btn.classList.add("wrong");
  }
  setTimeout(next,700);
}

function autoCorrect(){
  options.children[questions[i].correct].classList.add("correct");
  setTimeout(next,700);
}

function next(){
  i++;
  if(i<questions.length) showQ();
  else finish();
}

async function finish(){
  quizBox.style.display="none";
  resultBox.style.display="block";
  localStorage.setItem("attempt",today);

  resultBox.innerHTML=`
    <h2>${userName}</h2>
    <h1>${score}/${questions.length}</h1>
    <p>Rajasthan GK Zone</p>
    <p>ðŸ“¸ Screenshot & Share</p>
  `;

  await addDoc(collection(db,"leaderboard"),{
    name:userName,
    score,
    date:today
  });
}
</script>
</body>
</html>
